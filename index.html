<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>THE HUNGRY PISTOL v5.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #e0e5ec;
            --shadow-light: 12px 12px 20px #a3b1c6, -12px -12px 20px #ffffff;
            --shadow-inset: inset 6px 6px 12px #b8b9be, inset -6px -6px 12px #ffffff;
            --accent-color: #ff6b00;
            --primary-dark: #2d3436;
            --text-main: #2d3748;
        }

        body { 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            font-family: 'Assistant', sans-serif; 
            margin: 0; padding: 15px;
            display: flex; justify-content: center;
        }

        .app-shell {
            width: 100%; max-width: 480px;
            background: var(--bg-color);
            border-radius: 40px; padding: 25px;
            box-shadow: var(--shadow-light);
            position: relative;
        }

        /* Neumorphic Components */
        .logo-wrap {
            width: 80px; height: 80px; margin: 0 auto 20px;
            background: var(--bg-color); border-radius: 20px;
            box-shadow: var(--shadow-light);
            display: flex; align-items: center; justify-content: center;
        }
        .logo-wrap img { width: 60px; border-radius: 10px; }

        input, select {
            width: 100%; padding: 15px; border-radius: 15px;
            border: none; background: var(--bg-color);
            box-shadow: var(--shadow-inset);
            box-sizing: border-box; font-size: 16px; margin-bottom: 20px;
            outline: none; color: var(--text-main);
        }

        .btn-submit {
            width: 100%; padding: 20px; border: none; border-radius: 20px;
            background: var(--bg-color); color: var(--accent-color);
            font-weight: 800; font-size: 18px; cursor: pointer;
            box-shadow: var(--shadow-light); transition: 0.2s;
        }
        .btn-submit:active { box-shadow: var(--shadow-inset); transform: scale(0.98); }

        .lang-btn {
            position: absolute; top: 20px; left: 20px;
            background: var(--bg-color); border: none;
            padding: 10px; border-radius: 12px;
            box-shadow: var(--shadow-light); font-weight: 800; cursor: pointer;
        }

        .tabs-nav { display: flex; gap: 10px; margin-bottom: 25px; }
        .tab-trigger {
            flex: 1; padding: 12px; border: none; border-radius: 15px;
            background: var(--bg-color); box-shadow: var(--shadow-light);
            font-weight: 700; cursor: pointer; color: var(--text-main);
        }
        .tab-trigger.active { box-shadow: var(--shadow-inset); color: var(--accent-color); }

        .console-box {
            background: #1a202c; color: #48bb78; padding: 15px;
            border-radius: 15px; font-family: monospace; font-size: 14px;
            white-space: pre-wrap; margin-top: 15px; text-align: left; direction: ltr;
        }

        #loader {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(224, 229, 236, 0.8); z-index: 1000;
            flex-direction: column; align-items: center; justify-content: center;
        }
        .spinner { width: 40px; height: 40px; border: 4px solid #cbd5e0; border-top-color: var(--accent-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="loader">
    <div class="spinner"></div>
</div>

<div class="app-shell">
    <button class="lang-btn" onclick="UI.toggleLang()">RU/HE</button>
    
    <div class="logo-wrap">
        <img src="https://i.ibb.co/0pgKvP8y/1770184520210.png" alt="Logo">
    </div>
    <h2 id="app-title" style="text-align:center; margin-bottom:25px;">THE HUNGRY PISTOL</h2>

    <div class="tabs-nav">
        <button class="tab-trigger active" onclick="UI.switchTab('order')" id="tab-order">×”×–×× ×”</button>
        <button class="tab-trigger" onclick="UI.switchTab('history')" id="tab-history">×”×™×¡×˜×•×¨×™×”</button>
        <button class="tab-trigger" onclick="UI.switchTab('admin')" id="tab-admin">× ×™×”×•×œ</button>
    </div>

    <div id="view-order">
        <label id="lbl-name" style="font-weight:700; display:block; margin-bottom:8px;">×©× ×¢×•×‘×“</label>
        <input type="text" id="name" list="employee-options" placeholder="×‘×—×¨ ×©× ××”×¨×©×™××”...">
        <datalist id="employee-options"></datalist>

        <label id="lbl-type" style="font-weight:700; display:block; margin-bottom:8px;">×¡×•×’ ×× ×”</label>
        <select id="type"></select>

        <label id="lbl-meat" style="font-weight:700; display:block; margin-bottom:8px;">×‘×—×™×¨×ª ×‘×©×¨</label>
        <select id="meat"></select>

        <label id="lbl-drink" style="font-weight:700; display:block; margin-bottom:8px;">×©×ª×™×™×”</label>
        <select id="drink"></select>

        <label id="lbl-note" style="font-weight:700; display:block; margin-bottom:8px;">×”×¢×¨×•×ª</label>
        <input type="text" id="note">

        <button class="btn-submit" onclick="UI.submitOrder()" id="btn-submit">×©×œ×— ×”×–×× ×”</button>
    </div>

    <div id="view-history" style="display:none;">
        <div id="hist-list"></div>
    </div>

    <div id="view-admin" style="display:none;">
        <button class="btn-submit" onclick="UI.fetchSummary()">×”×¤×§ ×¡×™×›×•× ×™×•××™</button>
        <div id="admin-results" style="display:none; margin-top:20px;">
            <div class="console-box" id="out-he"></div>
            <button class="btn-submit" style="margin-top:10px; padding:10px;" onclick="UI.copy('out-he')">×”×¢×ª×§ ×¢×‘×¨×™×ª ğŸ“‹</button>
            <div class="console-box" id="out-ru"></div>
            <button class="btn-submit" style="margin-top:10px; padding:10px;" onclick="UI.copy('out-ru')">ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ RU ğŸ“‹</button>
        </div>
    </div>
</div>

<script>
    const PROXY_URL = "https://rough-bush-1bda.talll77.workers.dev";

    const APP_DATA = {
        employees: [
            { he: "×¨×©×™×“ ×‘××§×™×™×‘", ru: "Ğ Ğ°ÑˆĞ¸Ğ´ Ğ‘Ğ°ĞºĞ°ĞµĞ²", id: "10211" },
            { he: "×˜×œ ×œ×“×™×–'×™× ×¡×§×™", ru: "Ğ¢Ğ°Ğ»ÑŒ Ğ›Ğ°Ğ´Ñ‹Ğ¶Ğ¸Ğ½ÑĞºĞ¸Ğ¹", id: "10201" },
            { he: "×¡×¨×’×™×™ ×¡×•×¤×•× ×™×¦×§×™", ru: "Ğ¡ĞµÑ€Ğ³ĞµĞ¹ Ğ¡Ğ¾Ñ„Ğ¾Ğ½Ğ¸Ñ†ĞºĞ¸Ğ¹", id: "100149" },
            { he: "×× ×“×¨×™×™ ×‘×™×™×˜×™×Ÿ", ru: "ĞĞ½Ğ´Ñ€ĞµĞ¹ Ğ‘ĞµĞ¹Ñ‚Ğ¸Ğ½", id: "101088" },
            { he: "×§×¨×™××¨ ××œ×›×¡× ×“×¨", ru: "ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€ ĞšÑ€Ğ¸Ğ¼ĞµÑ€", id: "10238" },
            { he: "×§×•×¡×˜×™×” ××¡×§×¨×•×‘", ru: "ĞšĞ¾ÑÑ‚Ñ AÑĞºĞ°Ñ€Ğ¾Ğ²", id: "10318" },
            { he: "×× ×’'×œ×™×§×” ×¤×•××–×•× ×•×‘×¡×§×™", ru: "ĞĞ½Ğ¶ĞµĞ»Ğ¸ĞºĞ° ĞŸĞ¾Ğ¼Ğ¾Ğ·Ğ¾Ğ½Ğ¾Ğ²ÑĞºĞ¸", id: "10229" }
        ],
        main_course: [
            { he: "××’×©", ru: "Ğ’ Ğ»Ğ¾Ñ‚ĞºĞµ (Ğ¥Ğ°Ğ¼Ğ³Ğ°ÑˆĞ¸Ñ‚)" },
            { he: "×‘×¤×™×ª×” (×›×•×œ×œ ×¤×—×™×ª ×©×ª×™×™×”)", ru: "Ğ’ Ğ¿Ğ¸Ñ‚Ğµ (Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ Ğ½Ğ°Ğ¿Ğ¸Ñ‚Ğ¾Ğº)" },
            { he: "×‘×‘×’×˜ (×›×•×œ×œ ×¤×—×™×ª ×©×ª×™×™×”)", ru: "Ğ’ Ğ±Ğ°Ğ³ĞµÑ‚Ğµ (Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ Ğ½Ğ°Ğ¿Ğ¸Ñ‚Ğ¾Ğº)" }
        ],
        meat: [
            { he: "××¢×•×¨×‘ ×’×‘×™", ru: "ÑĞ¼ĞµÑˆĞ°Ğ½Ğ½Ñ‹Ğ¹ Ğ“Ğ°Ğ±Ğ¸" },
            { he: "×¤×¨×’×™×ª", ru: "ĞŸĞ°Ñ€Ğ³Ğ¸Ñ‚" },
            { he: "×©×•×•××¨××”", ru: "Ğ¨Ğ°ÑƒÑ€Ğ¼Ğ°" },
            { he: "×§×‘×‘", ru: "ĞšĞµĞ±Ğ°Ğ±" }
        ],
        beverages: [
            { he: "×§×•×œ×” ×–×™×¨×•", ru: "ĞšĞ¾Ğ»Ğ° Ğ—ĞµÑ€Ğ¾" },
            { he: "×§×•×œ×”", ru: "ĞšĞ¾Ğ»Ğ°" },
            { he: "×¡×¤×¨×™×™×˜", ru: "Ğ¡Ğ¿Ñ€Ğ°Ğ¹Ñ‚" }
        ]
    };

    const UI = {
        lang: 'he',

        init() {
            this.renderStatic();
            this.renderDynamic();
        },

        renderStatic() {
            const list = document.getElementById('employee-options');
            list.innerHTML = APP_DATA.employees.map(e => `<option value="${e.he}">${e.id}</option>`).join('');
        },

        renderDynamic() {
            this.fillSelect('type', APP_DATA.main_course);
            this.fillSelect('meat', APP_DATA.meat);
            this.fillSelect('drink', APP_DATA.beverages);
            this.updateLabels();
        },

        fillSelect(id, data) {
            const el = document.getElementById(id);
            el.innerHTML = data.map(item => `<option value="${item.he}">${this.lang === 'he' ? item.he : item.ru}</option>`).join('');
        },

        updateLabels() {
            const dict = {
                he: { title: 'THE HUNGRY PISTOL', submit: '×©×œ×— / ×¢×“×›×Ÿ ×”×–×× ×”', order: '×”×–×× ×”', history: '×”×™×¡×˜×•×¨×™×”', admin: '× ×™×”×•×œ', name: '×©× ×¢×•×‘×“', type: '×¡×•×’ ×× ×”', meat: '×‘×—×™×¨×ª ×‘×©×¨', drink: '×©×ª×™×™×”', note: '×”×¢×¨×•×ª' },
                ru: { title: 'Ğ“ĞĞ›ĞĞ”ĞĞ«Ğ™ ĞŸĞ˜Ğ¡Ğ¢ĞĞ›Ğ•Ğ¢', submit: 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ / ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ', order: 'Ğ—Ğ°ĞºĞ°Ğ·', history: 'Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ', admin: 'ĞĞ´Ğ¼Ğ¸Ğ½', name: 'Ğ˜Ğ¼Ñ', type: 'Ğ¢Ğ¸Ğ¿ Ğ±Ğ»ÑĞ´Ğ°', meat: 'Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¼ÑÑĞ°', drink: 'ĞĞ°Ğ¿Ğ¸Ñ‚Ğ¾Ğº', note: 'Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸' }
            };
            const d = dict[this.lang];
            document.getElementById('app-title').innerText = d.title;
            document.getElementById('btn-submit').innerText = d.submit;
            document.getElementById('tab-order').innerText = d.order;
            document.getElementById('tab-history').innerText = d.history;
            document.getElementById('tab-admin').innerText = d.admin;
            document.getElementById('lbl-name').innerText = d.name;
            document.getElementById('lbl-type').innerText = d.type;
            document.getElementById('lbl-meat').innerText = d.meat;
            document.getElementById('lbl-drink').innerText = d.drink;
            document.getElementById('lbl-note').innerText = d.note;
        },

        toggleLang() {
            this.lang = this.lang === 'he' ? 'ru' : 'he';
            document.documentElement.dir = this.lang === 'he' ? 'rtl' : 'ltr';
            this.renderDynamic();
        },

        switchTab(tab) {
            ['order', 'history', 'admin'].forEach(v => {
                document.getElementById('view-' + v).style.display = (v === tab) ? 'block' : 'none';
                document.getElementById('tab-' + v).classList.toggle('active', v === tab);
            });
            if(tab === 'history') this.loadHistory();
        },

        setLoading(s) { document.getElementById('loader').style.display = s ? 'flex' : 'none'; },

        async api(action, data = {}) {
            this.setLoading(true);
            try {
                const res = await fetch(PROXY_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action, ...data })
                });
                const json = await res.json();
                this.setLoading(false);
                return json.success ? json.data : (alert(json.error), null);
            } catch (e) {
                this.setLoading(false);
                alert("Network Error");
                return null;
            }
        },

        async submitOrder() {
            const name = document.getElementById('name').value;
            if(!name) return alert("×‘×—×¨ ×©×");
            const res = await this.api('submitOrder', {
                data: {
                    name,
                    type: document.getElementById('type').value,
                    meat: document.getElementById('meat').value,
                    drink: document.getElementById('drink').value,
                    note: document.getElementById('note').value
                }
            });
            if(res) alert(res);
        },

        async loadHistory() {
            const name = document.getElementById('name').value;
            if(!name) return;
            const res = await this.api('getHistory', { name });
            if(res) {
                document.getElementById('hist-list').innerHTML = res.map(i => `
                    <div style="background:var(--bg-color); box-shadow:var(--shadow-inset); padding:15px; border-radius:15px; margin-bottom:10px;">
                        <b>${i.date}</b>: ${i.order} (${i.drink})
                    </div>
                `).join('');
            }
        },

        async fetchSummary() {
            const res = await this.api('getSummary');
            if(res) {
                document.getElementById('admin-results').style.display = 'block';
                document.getElementById('out-he').innerText = res.he.raw.replace(/\\n/g, '\n');
                document.getElementById('out-ru').innerText = res.ru.raw.replace(/\\n/g, '\n');
            }
        },

        copy(id) {
            navigator.clipboard.writeText(document.getElementById(id).innerText).then(() => alert("Copied!"));
        }
    };

    window.onload = () => UI.init();
</script>
</body>
</html>
